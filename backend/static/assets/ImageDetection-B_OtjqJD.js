import{r as l,f as R,w as j,o as P,g as $,c as n,a as e,h as x,t as o,k as M,b as G,i as u,n as I,j as z,v as J,l as T,F as O,m as q,d as U,E as p,e as i}from"./index-BszAOtP9.js";import{_ as A}from"./_plugin-vue_export-helper-DlAUqK2U.js";const K={class:"detection-container"},Q={class:"content-grid"},W={class:"image-section"},X={class:"image-card"},Y={class:"image-header"},Z={key:0,class:"stat-badge time"},ee={class:"image-wrapper"},se={key:1,class:"image-display"},te=["src"],ae={class:"image-controls"},le=["disabled"],oe={class:"dropdown-wrapper"},ne={class:"dropdown-menu conf-menu"},ie={class:"conf-slider-wrap"},de={class:"conf-value"},ce={key:0,class:"file-info"},re={class:"info-section"},ve={class:"result-card"},ue={class:"detection-stats"},pe={class:"detection-stat"},me={class:"stat-circle fire"},fe={class:"stat-num"},he={class:"detection-stat"},ge={class:"stat-circle smoke"},_e={class:"stat-num"},we={class:"detection-list"},be={class:"det-conf"},Ce={key:0,class:"empty-state"},ke={class:"eval-card"},ye={class:"eval-buttons"},xe=["disabled"],Me=["disabled"],ze={__name:"ImageDetection",setup(Le){const y=l(null),d=l(null),h=l(""),g=l(""),m=l(!1),_=l(0),w=l(0),b=l([]),f=l(0),C=l(""),c=l(.5),k=l(!1),r=R(()=>b.value.filter(t=>t.confidence>=c.value));j(r,t=>{_.value=t.filter(s=>s.class_name.toLowerCase().includes("fire")).length,w.value=t.filter(s=>s.class_name.toLowerCase().includes("smoke")).length});const L=t=>{t.target.closest(".dropdown-wrapper")||(k.value=!1)};P(()=>document.addEventListener("click",L)),$(()=>document.removeEventListener("click",L));const B=()=>y.value.click(),E=t=>{t.target.files[0]&&D(t.target.files[0])},N=t=>{t.dataTransfer.files[0]&&D(t.dataTransfer.files[0])},D=t=>{d.value=t,h.value=URL.createObjectURL(t),g.value="",b.value=[],_.value=0,w.value=0,f.value=0,p.success("图片加载成功")},S=async()=>{var t,s;if(d.value){m.value=!0;try{const a=new FormData;a.append("file",d.value),a.append("conf_threshold",c.value);const v=await U.post("/api/inference/image",a,{headers:{"Content-Type":"multipart/form-data"}});if(v.data.success){const V=v.data.result;b.value=V.detections||[],f.value=Math.round((V.processing_time||0)*1e3),v.data.visualization&&(g.value=v.data.visualization),p.success("检测完成")}else p.error("检测失败")}catch(a){p.error("检测失败: "+(((s=(t=a.response)==null?void 0:t.data)==null?void 0:s.detail)||a.message))}finally{m.value=!1}}},H=()=>{d.value=null,h.value="",g.value="",b.value=[],_.value=0,w.value=0,f.value=0,y.value.value=""},F=async t=>{try{const s=new FormData;s.append("detection_id",Date.now().toString()),s.append("is_correct",t),s.append("detection_type",r.value.map(a=>a.class_name).join(",")),s.append("source_type","image"),s.append("notes",C.value),await U.post("/api/evaluation",s),p.success("评定提交成功"),C.value=""}catch{p.error("评定提交失败")}};return(t,s)=>(i(),n("div",K,[s[22]||(s[22]=e("header",{class:"page-header"},[e("h1",{class:"page-title"},"图片检测"),e("p",{class:"page-desc"},"上传图片快速获取火灾烟雾检测结果")],-1)),e("div",Q,[e("div",W,[e("div",X,[e("div",Y,[s[6]||(s[6]=e("span",{class:"image-title"},"图片预览",-1)),f.value>0?(i(),n("span",Z,"处理: "+o(f.value)+"ms",1)):x("",!0)]),e("div",ee,[h.value?(i(),n("div",se,[e("img",{src:g.value||h.value,class:"preview-image"},null,8,te)])):(i(),n("div",{key:0,class:"image-placeholder upload-zone",onClick:B,onDragover:s[0]||(s[0]=M(()=>{},["prevent"])),onDrop:M(N,["prevent"])},[...s[7]||(s[7]=[G('<div class="placeholder-icon" data-v-7d8eb19a><svg viewBox="0 0 24 24" width="48" height="48" fill="currentColor" data-v-7d8eb19a><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z" data-v-7d8eb19a></path></svg></div><p class="placeholder-text" data-v-7d8eb19a>拖拽图片到此处，或点击上传</p><p class="placeholder-hint" data-v-7d8eb19a>支持 JPG, PNG, BMP 等格式</p>',3)])],32))]),e("div",ae,[e("button",{class:"btn btn-secondary",onClick:B},[...s[8]||(s[8]=[e("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor"},[e("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"})],-1),u(" 选择图片 ",-1)])]),e("button",{class:I(["btn btn-primary",{loading:m.value}]),onClick:S,disabled:!d.value},[s[9]||(s[9]=e("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor"},[e("path",{d:"M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6 0 1.01-.25 1.97-.7 2.8l1.46 1.46C19.54 15.03 20 13.57 20 12c0-4.42-3.58-8-8-8zm0 14c-3.31 0-6-2.69-6-6 0-1.01.25-1.97.7-2.8L5.24 7.74C4.46 8.97 4 10.43 4 12c0 4.42 3.58 8 8 8v3l4-4-4-4v3z"})],-1)),u(" "+o(m.value?"检测中...":"开始检测"),1)],10,le),e("button",{class:"btn btn-ghost",onClick:H},[...s[10]||(s[10]=[e("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor"},[e("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})],-1),u(" 重置 ",-1)])]),e("div",oe,[e("button",{class:"btn btn-option",onClick:s[1]||(s[1]=M(a=>k.value=!k.value,["stop"]))},[s[11]||(s[11]=e("svg",{viewBox:"0 0 24 24",width:"20",height:"20",fill:"currentColor"},[e("path",{d:"M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"})],-1)),u(" "+o((c.value*100).toFixed(0))+"% ",1)]),z(e("div",ne,[e("div",ie,[s[12]||(s[12]=e("span",{class:"conf-label"},"置信度阈值",-1)),z(e("input",{type:"range","onUpdate:modelValue":s[2]||(s[2]=a=>c.value=a),min:"0.1",max:"0.9",step:"0.05",class:"conf-slider"},null,512),[[T,c.value]]),e("span",de,o((c.value*100).toFixed(0))+"%",1)])],512),[[J,k.value]])])]),d.value?(i(),n("div",ce,[s[13]||(s[13]=e("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor"},[e("path",{d:"M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"})],-1)),e("span",null,o(d.value.name),1)])):x("",!0)])]),e("div",re,[e("div",ve,[s[17]||(s[17]=e("div",{class:"card-header"},[e("span",{class:"card-title"},"检测结果")],-1)),e("div",ue,[e("div",pe,[e("div",me,[e("span",fe,o(_.value),1)]),s[14]||(s[14]=e("span",{class:"stat-name"},"火焰",-1))]),e("div",he,[e("div",ge,[e("span",_e,o(w.value),1)]),s[15]||(s[15]=e("span",{class:"stat-name"},"烟雾",-1))])]),e("div",we,[(i(!0),n(O,null,q(r.value,(a,v)=>(i(),n("div",{key:v,class:"detection-item"},[e("span",{class:I(["det-tag",a.class_name.includes("fire")?"fire":"smoke"])},o(a.class_name),3),e("span",be,o((a.confidence*100).toFixed(1))+"%",1)]))),128)),r.value.length===0&&!m.value?(i(),n("div",Ce,[...s[16]||(s[16]=[e("span",null,"暂无检测结果",-1)])])):x("",!0)])]),e("div",ke,[s[20]||(s[20]=e("div",{class:"card-header"},[e("span",{class:"card-title"},"结果评定")],-1)),s[21]||(s[21]=e("p",{class:"eval-hint"},"当前检测结果是否正确?",-1)),e("div",ye,[e("button",{class:"btn btn-success",onClick:s[3]||(s[3]=a=>F(!0)),disabled:r.value.length===0},[...s[18]||(s[18]=[e("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor"},[e("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})],-1),u(" 正确 ",-1)])],8,xe),e("button",{class:"btn btn-error",onClick:s[4]||(s[4]=a=>F(!1)),disabled:r.value.length===0},[...s[19]||(s[19]=[e("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor"},[e("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1),u(" 错误 ",-1)])],8,Me)]),z(e("textarea",{"onUpdate:modelValue":s[5]||(s[5]=a=>C.value=a),class:"eval-textarea",placeholder:"备注信息(可选)"},null,512),[[T,C.value]])])])]),e("input",{type:"file",ref_key:"fileInputRef",ref:y,accept:"image/*",style:{display:"none"},onChange:E},null,544)]))}},Fe=A(ze,[["__scopeId","data-v-7d8eb19a"]]);export{Fe as default};
