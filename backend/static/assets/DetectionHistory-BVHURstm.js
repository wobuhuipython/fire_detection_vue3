import{r as y,o as H,c as i,a as e,h as m,n as p,i as d,F as V,m as D,t as a,k as b,d as _,E as g,p as x,e as n}from"./index-BszAOtP9.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";const F={class:"history-container"},N={class:"toolbar"},S={class:"filter-group"},T=["disabled"],I={key:0,class:"history-grid"},P=["onClick"],R=["src","alt"],j={class:"card-content"},U={class:"card-stats"},q={key:0,class:"stat fire"},A={key:1,class:"stat smoke"},G={class:"card-meta"},J={class:"time"},K={key:0,class:"eval-actions"},O=["onClick"],Q=["onClick"],W=["onClick"],X={key:1,class:"empty-state"},Y={key:2,class:"pagination"},Z=["disabled"],tt={class:"page-info"},et=["disabled"],st=["src"],lt={class:"preview-info"},ot={key:0,class:"preview-eval"},it={class:"preview-eval-btns"},at={key:1,class:"preview-eval-result"},nt={__name:"DetectionHistory",setup(rt){const h=y([]),v=y({page:1,page_size:20,total:0,total_pages:0}),u=y(""),o=y(null),c=async(l=1)=>{try{const t={page:l,page_size:20};u.value&&(t.source_type=u.value);const s=await _.get("/api/history",{params:t});h.value=s.data.records,v.value=s.data.pagination}catch{g.error("加载历史记录失败")}},w=async(l,t)=>{var s;try{const r=new FormData;r.append("detection_id",l.id),r.append("is_correct",t),r.append("detection_type",((s=l.detections)==null?void 0:s.map(L=>L.class_name).join(","))||""),r.append("source_type",l.source_type),r.append("notes",""),await _.post("/api/evaluation",r),l.is_evaluated=!0,l.is_correct=t,g.success("评定提交成功")}catch{g.error("评定提交失败")}},M=async l=>{try{await x.confirm("确定删除这条记录吗？","确认删除",{type:"warning"}),await _.delete(`/api/history/${l}`),g.success("删除成功"),c(v.value.page)}catch(t){t!=="cancel"&&g.error("删除失败")}},$=async()=>{try{await x.confirm("确定清空所有检测历史吗？此操作不可恢复！","确认清空",{type:"warning"}),await _.delete("/api/history"),g.success("历史记录已清空"),c()}catch(l){l!=="cancel"&&g.error("清空失败")}},f=l=>c(l),B=l=>{o.value=l},C=l=>`http://${window.location.hostname}:8000/static/history/${l}`,k=l=>({camera:"摄像头",video:"视频",image:"图片"})[l]||l,z=l=>l?new Date(l).toLocaleString("zh-CN"):"";return H(()=>c()),(l,t)=>(n(),i("div",F,[t[30]||(t[30]=e("header",{class:"page-header"},[e("h1",{class:"page-title"},"检测历史"),e("p",{class:"page-desc"},"查看所有检测到火灾/烟雾的历史记录，并进行评定")],-1)),e("div",N,[e("div",S,[e("button",{class:p(["filter-btn",{active:u.value===""}]),onClick:t[0]||(t[0]=s=>{u.value="",c()})},"全部",2),e("button",{class:p(["filter-btn",{active:u.value==="camera"}]),onClick:t[1]||(t[1]=s=>{u.value="camera",c()})},"摄像头",2),e("button",{class:p(["filter-btn",{active:u.value==="video"}]),onClick:t[2]||(t[2]=s=>{u.value="video",c()})},"视频",2),e("button",{class:p(["filter-btn",{active:u.value==="image"}]),onClick:t[3]||(t[3]=s=>{u.value="image",c()})},"图片",2)]),e("button",{class:"btn btn-danger",onClick:$,disabled:h.value.length===0},[...t[11]||(t[11]=[e("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor"},[e("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})],-1),d(" 清空历史 ",-1)])],8,T)]),h.value.length>0?(n(),i("div",I,[(n(!0),i(V,null,D(h.value,s=>(n(),i("div",{class:"history-card",key:s.id},[e("div",{class:"card-image",onClick:r=>B(s)},[e("img",{src:C(s.image_path),alt:s.id},null,8,R),t[12]||(t[12]=e("div",{class:"image-overlay"},[e("svg",{viewBox:"0 0 24 24",width:"32",height:"32",fill:"currentColor"},[e("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"})])],-1)),s.is_evaluated?(n(),i("div",{key:0,class:p(["eval-badge",s.is_correct?"correct":"incorrect"])},a(s.is_correct?"✓ 正确":"✗ 错误"),3)):m("",!0)],8,P),e("div",j,[e("div",U,[s.fire_count>0?(n(),i("span",q,[t[13]||(t[13]=e("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor"},[e("path",{d:"M13.5.67s.74 2.65.74 4.8c0 2.06-1.35 3.73-3.41 3.73-2.07 0-3.63-1.67-3.63-3.73l.03-.36C5.21 7.51 4 10.62 4 14c0 4.42 3.58 8 8 8s8-3.58 8-8C20 8.61 17.41 3.8 13.5.67zM11.71 19c-1.78 0-3.22-1.4-3.22-3.14 0-1.62 1.05-2.76 2.81-3.12 1.77-.36 3.6-1.21 4.62-2.58.39 1.29.59 2.65.59 4.04 0 2.65-2.15 4.8-4.8 4.8z"})],-1)),d(" 火焰 "+a(s.fire_count),1)])):m("",!0),s.smoke_count>0?(n(),i("span",A,[t[14]||(t[14]=e("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor"},[e("path",{d:"M19.48 12.35c-1.57-4.08-7.16-4.3-5.81-10.23.1-.44-.37-.78-.75-.55C9.29 3.71 6.68 8 8.87 13.62c.18.46-.36.89-.75.59-1.81-1.37-2-3.34-1.84-4.75.06-.52-.62-.77-.91-.34C4.69 10.16 4 11.84 4 14.37c.38 5.6 5.11 7.32 6.81 7.54 2.43.31 5.06-.14 6.95-1.87 2.08-1.93 2.84-5.01 1.72-7.69zm-9.28 5.03c1.44-.35 2.18-1.39 2.38-2.31.33-1.43-.96-2.83-.09-5.09.33 1.87 3.27 3.04 3.27 5.08.08 2.53-2.66 4.7-5.56 2.32z"})],-1)),d(" 烟雾 "+a(s.smoke_count),1)])):m("",!0)]),e("div",G,[e("span",{class:p(["source-tag",s.source_type])},a(k(s.source_type)),3),e("span",J,a(z(s.created_at)),1)]),s.is_evaluated?m("",!0):(n(),i("div",K,[e("button",{class:"eval-btn correct",onClick:b(r=>w(s,!0),["stop"]),title:"标记为正确"},[...t[15]||(t[15]=[e("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor"},[e("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})],-1)])],8,O),e("button",{class:"eval-btn incorrect",onClick:b(r=>w(s,!1),["stop"]),title:"标记为错误"},[...t[16]||(t[16]=[e("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor"},[e("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)])],8,Q)])),e("button",{class:"delete-btn",onClick:b(r=>M(s.id),["stop"])},[...t[17]||(t[17]=[e("svg",{viewBox:"0 0 24 24",width:"16",height:"16",fill:"currentColor"},[e("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})],-1)])],8,W)])]))),128))])):(n(),i("div",X,[...t[18]||(t[18]=[e("svg",{viewBox:"0 0 24 24",width:"64",height:"64",fill:"currentColor"},[e("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14zm-5-7l-3 3.72L9 13l-3 4h12l-4-5z"})],-1),e("p",null,"暂无检测历史记录",-1)])])),v.value.total_pages>1?(n(),i("div",Y,[e("button",{class:"page-btn",disabled:v.value.page<=1,onClick:t[4]||(t[4]=s=>f(v.value.page-1))},"上一页",8,Z),e("span",tt,a(v.value.page)+" / "+a(v.value.total_pages),1),e("button",{class:"page-btn",disabled:v.value.page>=v.value.total_pages,onClick:t[5]||(t[5]=s=>f(v.value.page+1))},"下一页",8,et)])):m("",!0),o.value?(n(),i("div",{key:3,class:"preview-modal",onClick:t[10]||(t[10]=s=>o.value=null)},[e("div",{class:"preview-content",onClick:t[9]||(t[9]=b(()=>{},["stop"]))},[e("img",{src:C(o.value.image_path)},null,8,st),e("div",lt,[t[28]||(t[28]=e("h3",null,"检测详情",-1)),e("p",null,[t[19]||(t[19]=e("strong",null,"来源:",-1)),d(" "+a(k(o.value.source_type)),1)]),e("p",null,[t[20]||(t[20]=e("strong",null,"时间:",-1)),d(" "+a(z(o.value.created_at)),1)]),e("p",null,[t[21]||(t[21]=e("strong",null,"火焰数量:",-1)),d(" "+a(o.value.fire_count),1)]),e("p",null,[t[22]||(t[22]=e("strong",null,"烟雾数量:",-1)),d(" "+a(o.value.smoke_count),1)]),e("p",null,[t[23]||(t[23]=e("strong",null,"处理时间:",-1)),d(" "+a((o.value.processing_time*1e3).toFixed(0))+"ms",1)]),o.value.is_evaluated?(n(),i("div",at,[e("p",null,[t[27]||(t[27]=e("strong",null,"评定结果:",-1)),e("span",{class:p(o.value.is_correct?"correct":"incorrect")},a(o.value.is_correct?"正确":"错误"),3)])])):(n(),i("div",ot,[t[26]||(t[26]=e("p",null,[e("strong",null,"评定结果:")],-1)),e("div",it,[e("button",{class:"btn btn-success",onClick:t[6]||(t[6]=s=>w(o.value,!0))},[...t[24]||(t[24]=[e("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor"},[e("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})],-1),d(" 正确 ",-1)])]),e("button",{class:"btn btn-error",onClick:t[7]||(t[7]=s=>w(o.value,!1))},[...t[25]||(t[25]=[e("svg",{viewBox:"0 0 24 24",width:"18",height:"18",fill:"currentColor"},[e("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1),d(" 错误 ",-1)])])])]))]),e("button",{class:"close-btn",onClick:t[8]||(t[8]=s=>o.value=null)},[...t[29]||(t[29]=[e("svg",{viewBox:"0 0 24 24",width:"24",height:"24",fill:"currentColor"},[e("path",{d:"M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"})],-1)])])])])):m("",!0)]))}},dt=E(nt,[["__scopeId","data-v-3a4ca59b"]]);export{dt as default};
